<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
        <link rel="stylesheet" href="/static_files/styles/gtt_lab_styles.css" type="text/css" media="all" charset="utf-8">
        <link rel="stylesheet" href="/static_files/algorithms/crossalive/additional.css" type="text/css" media="all" charset="utf-8">

		<title>CROSSalive</title>
	</head>

	<body>

		<div id="topbar">
			<div id="home_panel">
			<p><a href="/">Portal Home</a></p>
			</div>
			<div id="title_server">
				<h1>CROSSalive</h1>
			</div>
			<div id="navbar_server">
				<h3>[
                            <a target="" href="http://service.tartaglialab.com/new_submission/crossalive">CROSSalive Home
</a>
                             -
                            <a target="" href="http://service.tartaglialab.com/static_files/shared/tutorial_crossalive.html">Tutorial
</a>
                             -
                            <a target="" href="http://service.tartaglialab.com/static_files/algorithms/crossalive/documentation.html">Documentation
</a>
                             -
                            <a target="" href="http://pasteur.crg.es/portal/page/portal/827A462EAB6802B3E04012AC0E01291B">Group page @ CRG
</a>
                 ]</h3>
			</div>
		</div>

		<div id="welcome_server">
			<img src="/static_files/algorithms/crossalive/logo.png" />
			<h2>CROSSalive</h2>
            <p id="task_description">CROSSalive predicts the RNA secondary structure in vivo using contributions from the RNA sequence and the interactions with protein partners. CROSSalive is able to profile the RNA structure at single nucleotide resolution and it is the first algorithm trained on in vivo structural data.
</p>
			<br>
			<br>

			<div id="left_column">
			    &nbsp;
			</div>

			<div id="right_column">

                <!-- Do not modify below this line please -->

                <script src="/static_files/js/jquery-1.7.2.min.js"></script>
                <script src="/static_files/js/shared.js"></script>
                <script type="text/javascript">
                    // alert("test")
                </script>

                <h2>Submission reference: 256813</h2>

                <br />
                <!-- {u&#039;submission_id&#039;: u&#039;256813&#039;, u&#039;submitted&#039;: u&#039;False&#039;, u&#039;task_name&#039;: u&#039;crossalive&#039;, u&#039;directory&#039;: u&#039;submissions/2020-03/256813/&#039;, u&#039;submission_id_padded&#039;: u&#039;00000000000000256813&#039;, u&#039;submitter_ip&#039;: u&#039;79.152.50.41&#039;} -->



                <form id="formfields">
                <div class="form_row " id="title_row">
                    <span id="title_description" class="description">
                        <p>Submission label (optional)</p>
                    </span>
                        <input id="title" name="title" class="text  " type="text" value="">
                        </input><br />

			        <br />
                </div>
                <div class="form_row " id="sequence_one_row">
                    <span id="sequence_one_description" class="description">
                        <p>RNA Sequences (FASTA format, please ensure that your sequences only contain A, C, G, T, and U. Do not use !@#$% etc.; the minimum required sequence length is 70 nucleotides and the maximum 20000.)</p>
                    </span>



                    <!-- TODO enable restore of this one after refresh -->
                        <textarea  id="sequence_one" name="sequence_one" class="textarea required "></textarea><br />
			        <br />
                </div>
                <div class="form_row " id="feature_row">
                    <span id="feature_description" class="description">
                        <p><b>Calculate RNA Structural Profile:</b></p>
                    </span>
						<p>
								<input type="radio" id="feature_radio_noprot_m6a_minus" class="feature " name="feature" value="noprot_m6a_minus" checked='checked'> in vivo m6a- using RNA sequence (fast)<br>
                                <script type="text/javascript" charset="utf-8">
                                    $().ready(function(){
                                        $("#feature_radio_noprot_m6a_minus").click( function() {
                                            console.log("feature_radio_noprot_m6a_minus" + "clicked")
                                        })
                                    })
                                </script>
								<input type="radio" id="feature_radio_invivo_m6a_minus" class="feature " name="feature" value="invivo_m6a_minus" > in vivo m6a- using RNA sequence and protein interaction prediction (accurate)<br>
                                <script type="text/javascript" charset="utf-8">
                                    $().ready(function(){
                                        $("#feature_radio_invivo_m6a_minus").click( function() {
                                            console.log("feature_radio_invivo_m6a_minus" + "clicked")
                                        })
                                    })
                                </script>
								<input type="radio" id="feature_radio_noprot_m6a_plus" class="feature " name="feature" value="noprot_m6a_plus" > in vivo m6a+ using RNA sequence (fast)<br>
                                <script type="text/javascript" charset="utf-8">
                                    $().ready(function(){
                                        $("#feature_radio_noprot_m6a_plus").click( function() {
                                            console.log("feature_radio_noprot_m6a_plus" + "clicked")
                                        })
                                    })
                                </script>
								<input type="radio" id="feature_radio_invivo_m6a_plus" class="feature " name="feature" value="invivo_m6a_plus" > in vivo m6a+ using RNA sequence and protein interaction prediction (accurate)<br>
                                <script type="text/javascript" charset="utf-8">
                                    $().ready(function(){
                                        $("#feature_radio_invivo_m6a_plus").click( function() {
                                            console.log("feature_radio_invivo_m6a_plus" + "clicked")
                                        })
                                    })
                                </script>
						</p>

			        <br />
                </div>
                <div class="form_row " id="email_row">
                    <span id="email_description" class="description">
                        <p>Email address (optional, used for notification)</p>
                    </span>
                        <input id="email" name="email" class="email  " type="text" value="">
                        </input><br />

			        <br />
                </div>


                </form>
                <!-- {} -->

                <br /><br />

                <div>
                    <p>
                        Submission status:
                        <span id="cur_status"></span>
                        <input type="submit" disabled="disabled" class='' id="submitButton"  />
                    </p>

                </div>
                <br /><br />
                <div>
                    <h2>Sample data</h2>
                    <p>Just trying it out? Pre-populate the form with: (<b>Please, check that you do not have active proxies!</b>)</p>
                    <dl>
                            <dt style="padding-bottom:0.5em;">

                                <a href="/implement_example/256813/191058">Xist RepC</a>
                                 - Profile of the RepC of Xist, one of the least methylated regions of Xist, showing a Pearsonâ€™s correlation of 0.30 with <i>in vivo</i> SHAPE data (<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5027438/">Smola et al. 2016</a>)
                            </dt>
                    </dl>
                </div>


                <script type="text/javascript">

                $('#submitButton').click(function() {
                    $('#submitButton').val("Verifying...")
                    var return_val = test_form(true) //force synchronous ajax
                    // alert(return_val)
                    // enforce form post
                    if (return_val) {
                        try {
                        clearInterval(form_send_timer)
                        } catch (err) {
                            console.log(err)
                        }
                        var url_submit = "/submit/256813";
                        $('#submitButton').val("Sending...")
                        $(this).attr("readonly", "readonly");

                        outer_handle = function() {

                            inner_handle = function(req) {
                                // wait for a few seconds and reload, hacky way to fix submissions
                                setTimeout(function() {
                                    document.getElementById('cur_status').innerHTML = "Reloading...";
                                    // alert(req.responseText)
                                    location.reload(true)
                                }, 5000);
                            };
                            xml_http_post(url_submit, data, inner_handle)
                        }

                        // wait for 4s for everything to settle down a bit
                        // very bad practise but has to suffice atm
                        setTimeout(outer_handle, 4000)
                        // TODO change this to jquery
                    } else {
                        // form was not ok!
                        alert("The form is not valid. Please check!")
                        $('#submitButton').val("Submit")
                        $("#submitButton").attr("disabled", "disabled");
                    }


                    return false;
                });

                function status_updater() {
                    var test = {"fun":"temps", "data":""};
                    data = JSON.stringify(test)
                    inner_handle = function(req) {
                        document.getElementById('cur_status').innerHTML = req.responseText;
                        // alert(req.responseText)
                        var pattern = /^.*Complete/
                        str = String(req.responseText)
                        if (str.match(pattern)) {
                            $("#submitButton").removeAttr("disabled");
                        } else {
                            $("#submitButton").attr("disabled", "disabled");
                            // alert("no"+str)
                        }
                    };
                    xml_http_post("/submission_status/256813", data, inner_handle)

                    // submit data
                    $.ajax({
                        type: "POST",
                        url: "/form_submit/256813",
                        data: $("#formfields").serialize(),
                        success: function(data) {
                            // submit here?
                        },
                        async:   true,
                    });

                }
                status_updater()
                status_timer = window.setInterval(status_updater, 5000);



                function isValidEmailAddress(emailAddress) {
                    var pattern = new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);
                    return pattern.test(emailAddress);
                };



                // form_send_data()
                // form_send_timer = window.setInterval(form_send_data, 1000);

                var submission_id = 256813


                function test_form(blocking_post) {
                    var is_async
                    if (blocking_post) {
                        is_async = false
                    } else {
                        is_async = true
                    }

                    var emails = $("input.email")
                    var required_fields = $("form#formfields .required")

                    // test for email fields validity
                    var complete = true

                    var references = $("form#formfields input.reference")


                    required_fields.each(function(index,item) {
                        if (item.value == "") {
                            complete = false
                            $(this).addClass("wrong_field")
                        } else {
                            $(this).removeClass("wrong_field")
                        }
                    })

                    // length-limited text areas
                    var textareas = $("form#formfields textarea")

                    textareas.each(function (index, item) {
                        var char_count = $(this).val().length

                        var is_correct = true

                        if ($(this).data("min_length")) {
                            // add check for the length
                            var min_length = $(this).data("min_length")
                            if (char_count < min_length) {
                                is_correct = false
                            }
                        }

                        if (is_correct && $(this).data("max_length")) {
                            // add check for the length
                            var max_length = $(this).data("max_length")
                            if (char_count > max_length) {
                                is_correct = false
                            }
                        }

                        if (is_correct) {
                            $(this).removeClass("wrong_field")
                        } else {
                            $(this).addClass("wrong_field")
                            complete = false
                        }
                    })

                    emails.each(function(index, item) {
                        if (!isValidEmailAddress(item.value) && item.value != "") {
                            complete = false
                            $(this).addClass("wrong_field")
                        } else {
                            $(this).removeClass("wrong_field")
                        }
                        // alert(item.value)
                    })


                    references.each(function(index,item) {
                        // check the reference
                        // alert(submission_id);

                        // get parent
                        var parent_row = $(item).parent(".form_row")

                        // based on visibility the check is performed/skipped
                        var is_visible = parent_row.is(":visible")
                        var me = $(this)
                        if (is_visible) {
                            console.log("visible")

                            var field_name = item.name
                            var field_value = item.value

                            var callback_url  = "/reference_info/"+ submission_id+"/"+encodeURIComponent(field_name)+
                                                "/"+encodeURIComponent(field_value)+"/"

                            // TODO add password check

                            // alert(callback_url)

                            complete = false
                            // $(this).addClass("wrong_field")

                            me.removeClass("wrong_field")
                            jQuery.ajax({
                                 url:    callback_url,
                                 success: function(result) {
                                                if(result == "reference_is_ok") {
                                                     complete = true
                                                     me.removeClass("wrong_field")
                                                     // alert("all ok")
                                                     // TODO - this will not work
                                                     // when we have more fields,
                                                     // FIX later
                                                     $.ajax({
                                                         type: "POST",
                                                         url: "/form_submit/256813",
                                                         data: $("#formfields").serialize(),
                                                         success: function(data) {
                                                             // submit here?
                                                         },
                                                         async:   true,
                                                     });
                                                } else {
                                                    me.addClass("wrong_field")
                                                }
                                          },
                                  error: function(res) {
                                        me.addClass("wrong_field")
                                  },
                                  async:   is_async
                              });
                                    //
                        } else {
                            console.log("Invisible reference, not checking..")
                            me.removeClass("wrong_field")
                            me.addClass("wrong_field")
                        }
                    })

                    // TODO - for submission, this request
                    // must not be async
                    if (complete) {
                        // alert("form complete!")

                        $.ajax({
                            type: "POST",
                            url: "/form_submit/256813",
                            data: $("#formfields").serialize(),
                            success: function(data) {
                                // submit here?
                            },
                            async:   is_async,
                        });
                    } else {
                        // alert("form incomplete!")
                        // disable the form
                        // console.log("form incomplete")
                        $('.frozen').attr("readonly", "readonly");
                        $('.frozen').attr("disabled", "disabled");
                        $("#submitButton.frozen").hide();
                    }

                    // console.log("runnin?")
                    // console.log(complete)

                    // return false
                    return complete
                }

                // TODO - timer disabled for now, the execution happen on the submit
                // form_send_timer = window.setInterval(test_form, 5000);
                test_form()



                // $("#formfields input").blur(function() {
                //     test();
                // })

                </script>
                <style type="text/css">
                    .wrong_field {
                        border: 2px solid red;
                    }
                    .frozen {

                    }

                    input.reference {
                        width:200px;
                    }
                </style>

                <script type="text/javascript" charset="utf-8">
                    $().ready(function(){

                        $(".init_hidden").each(function(index, item) {
                            $(item).hide()
                        })
                    })
                </script>
                <!--{&#039;title_styled&#039;: &#039;CROSSalive\n&#039;, &#039;description&#039;: &#039;CROSSalive predicts the RNA secondary structure in vivo using contributions from the RNA sequence and the interactions with protein partners. CROSSalive is able to profile the RNA structure at single nucleotide resolution and it is the first algorithm trained on in vivo structural data.\n&#039;, &#039;algorithm&#039;: {&#039;command&#039;: &#039;crossalive.py -text=Yes -output_dir=&lt;output_dir&gt;&#039;, &#039;processing_timeout&#039;: 86400}, &#039;title&#039;: &#039;CROSSalive&#039;, &#039;description_short&#039;: &#039;Computes the structure of RNA molecules in vivo. Changes of structure upon N6-Methyladenosine methylation can be predicted.\n&#039;, &#039;form_fields&#039;: [{&#039;required&#039;: False, &#039;type&#039;: &#039;text&#039;, &#039;name&#039;: &#039;title&#039;, &#039;description&#039;: &#039;Submission label (optional)&#039;}, {&#039;min_indiv_len&#039;: 70, &#039;name&#039;: &#039;sequence_one&#039;, &#039;min_sequences&#039;: 1, &#039;required&#039;: True, &#039;type&#039;: &#039;textarea&#039;, &#039;description&#039;: &#039;RNA Sequences (FASTA format, please ensure that your sequences only contain A, C, G, T, and U. Do not use !@#$% etc.; the minimum required sequence length is 70 nucleotides and the maximum 20000.)&#039;}, {&#039;description&#039;: &#039;&lt;b&gt;Calculate RNA Structural Profile:&lt;/b&gt;&#039;, &#039;required&#039;: True, &#039;type&#039;: &#039;radio&#039;, &#039;name&#039;: &#039;feature&#039;, &#039;entries&#039;: [{&#039;value&#039;: &#039;noprot_m6a_minus&#039;, &#039;title&#039;: &#039;in vivo m6a- using RNA sequence (fast)&#039;}, {&#039;value&#039;: &#039;invivo_m6a_minus&#039;, &#039;title&#039;: &#039;in vivo m6a- using RNA sequence and protein interaction prediction (accurate)&#039;}, {&#039;value&#039;: &#039;noprot_m6a_plus&#039;, &#039;title&#039;: &#039;in vivo m6a+ using RNA sequence (fast)&#039;}, {&#039;value&#039;: &#039;invivo_m6a_plus&#039;, &#039;title&#039;: &#039;in vivo m6a+ using RNA sequence and protein interaction prediction (accurate)&#039;}]}, {&#039;required&#039;: False, &#039;type&#039;: &#039;email&#039;, &#039;name&#039;: &#039;email&#039;, &#039;description&#039;: &#039;Email address (optional, used for notification)&#039;}], &#039;version&#039;: 1.0, &#039;examples&#039;: [{&#039;title&#039;: &#039;Xist RepC&#039;, &#039;description&#039;: u&#039;Profile of the RepC of Xist, one of the least methylated regions of Xist, showing a Pearson\u2019s correlation of 0.30 with &lt;i&gt;in vivo&lt;/i&gt; SHAPE data (&lt;a href=&quot;https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5027438/&quot;&gt;Smola et al. 2016&lt;/a&gt;)&#039;, &#039;reference_id&#039;: 191058}], &#039;output&#039;: [None], &#039;nav_links&#039;: [{&#039;href&#039;: &#039;http://service.tartaglialab.com/new_submission/crossalive\n&#039;, &#039;title&#039;: &#039;CROSSalive Home\n&#039;}, {&#039;href&#039;: &#039;http://service.tartaglialab.com/static_files/shared/tutorial_crossalive.html\n&#039;, &#039;title&#039;: &#039;Tutorial\n&#039;}, {&#039;href&#039;: &#039;http://service.tartaglialab.com/static_files/algorithms/crossalive/documentation.html\n&#039;, &#039;title&#039;: &#039;Documentation\n&#039;}, {&#039;href&#039;: &#039;http://pasteur.crg.es/portal/page/portal/827A462EAB6802B3E04012AC0E01291B\n&#039;, &#039;title&#039;: &#039;Group page @ CRG\n&#039;}], &#039;name&#039;: &#039;crossalive&#039;}-->

    			<br />
			</div>
			<br />
         </div>
		<div id="footer_main">
            <br />
			<hr>
			<p>&copy; 2012 - <a href="http://big.crg.cat/gene_function_and_evolution" target="_blank">Gene Function and Evolution</a> - <a href="http://www.crg.eu" target="_blank">Center for Genomic Regulation (CRG)</a></p>
		</div>

	</body>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-38065167-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
</html>
