

<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<link rel="icon" href="/static/favicon.ico">

<title> Capture HiC Plotter </title>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<link rel="stylesheet" href="//cdn.datatables.net/1.10.8/css/dataTables.bootstrap.min.css">
<link rel="stylesheet" href="//cdn.datatables.net/responsive/1.0.7/css/responsive.dataTables.min.css">

<link href="/static/chicp/css/extra.87b5d2964c31.css" rel="stylesheet">


<link href="/static/chicp/css/bootstrap-slider.403576c4480d.css" rel="stylesheet">
<link href="/static/chicp/css/bootstrap.fd.6fd457ab2f28.css" rel="stylesheet">
<link href="/static/chicp/css/jquery.cookiebar.2c14815c8260.css" rel="stylesheet">
<link href="/static/chicp/css/tipsy.dce795c36f33.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="/static/chicp/css/modal.b66a7f00b6de.css" rel="stylesheet">

<style>
<!--
.examples > a:before {
    font-family: FontAwesome;
    content:"\f147";
    padding: 0px 5px;
}
.examples > a.collapsed:before {
    content:"\f196";
}
.examples > a:hover,
.examples > a:active,
.examples > a:focus  {
    text-decoration:none;
}
-->
</style>


<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->

<script type="text/javascript" src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>


    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-324292-13']);
      _gaq.push(['_trackPageview']);
      _gaq.push(['_setDomainName', 'www.chicp.org']); _gaq.push(['_setAllowHash', false]);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>

</head>

<body>

	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="/chicp/"><span class="chicp_name">C</span>apture <span class="chicp_name">HiC</span> <span class="chicp_name">P</span>lotter (CHiCP)</a>
				<div class="btn-group pull-right" role="group" aria-label="expanding buttons">
					
					<button type="button" class="navbar-toggle btn btn-default" data-toggle="collapse" data-target=".sidebar"><i class="fa fa-search" style="color:white"></i></button>

					<button type="button" class="navbar-toggle btn btn-default" data-toggle="collapse" data-target=".navbar-collapse">
						<span class="sr-only">Toggle navigation</span>
						<i class="fa fa-bars" style="color:white"></i>
					</button>
				</div>
			</div>
            <div class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li><a href="#ContactModal" data-toggle="modal"><i class="fa fa-envelope"></i>&nbsp;Contact Us</a></li>
					<li id="docs" class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-file"></i>&nbsp;Documentation<b class="caret"></b></a>
						<ul class="dropdown-menu">
							<li><a href="/chicp/docs/about/"> About</a></li>
							<li><a href="/chicp/docs/"> Full Documentation</a></li>
							<!-- <li><a href="/chicp/docs/installation/"> Installation</a></li> -->
						</ul>
					</li>
					
					<li><a href="#" data-toggle="modal" data-target="#settingsModal"><i class="fa fa-cog"></i>&nbsp; Settings</a></li>

				</ul>
				<ul class="nav navbar-nav navbar-right">
					


				<li class="dropdown">
					<a href="#" data-toggle="dropdown" class="dropdown-toggle"><i class="fa fa-sign-in"></i>&nbsp; Login<b class="caret"></b></a>
						<ul class="dropdown-menu" style="padding:15px;min-width:250px">
							<li>
	                           <div class="row">
	                              <div class="col-md-12">
	                                 <form class="form" role="form" method="POST" action="/accounts/login/" accept-charset="UTF-8" id="login-nav">
	                                    <input type='hidden' name='csrfmiddlewaretoken' value='GgU0h0bIa6NsuwTB7AOjervaXZMOiEFn' />
	                                    <div class="form-group">
	                                       <label class="sr-only" for="username">Username</label>
	                                       <input type="text" class="form-control" name="username" id="username" placeholder="Username" required>
	                                    </div>
	                                    <div class="form-group">
	                                       <label class="sr-only" for="password">Password</label>
	                                       <input type="password" class="form-control" name="password" id="password" placeholder="Password" required>
	                                    </div>
	                                    <div class="checkbox">
	                                       <label><input type="checkbox" name="remember_me" id="remember_me" checked="checked" value="1"> Remember me</label>
	                                    </div>
	                                    <div class="form-group">
	                                       <button type="submit" class="btn btn-primary btn-block" name="submit" value="Login" >Login</button>
	                                    </div>
	                                 </form>
	                                 <p><a href="/accounts/user/password/reset/">Forgotten/Reset password</a> 
	                                 <p><a href="/accounts/register">New User Registration</a>
	                              </div>
	                           </div>
	                        </li>
						</ul>
</li>



 
 
				</ul>
			</div>
		</div><!--/.container-fluid -->
	</nav>

	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-3 col-md-2 sidebar no-print">
				
				<ul class="nav nav-sidebar navbar-form navbar-left" style="margin-bottom:0px;">
					<!-- <form class="navbar-form navbar-left" role="search" name="search" style="margin-bottom:0px;">-->
				    <div class="input-group add-on" style="width:100%">
				      <input type="text" class="form-control" placeholder="Search" name="search_term" id="search_term" value="BACH2">
				      <div class="input-group-btn">
				        <button type="submit" class="btn btn-default" id="pushme"><i class="fa fa-search"></i></button>
				      </div>
				    </div>
					<input type="hidden" id="regionSearch" value="">
					<div class="panel-group" id="example_searches" aria-multiselectable="true">
						<div>
							<div id="headingOne" class="examples">
								<a class="collapsed" role="button" data-toggle="collapse" data-parent="#example_searches" href="#collapseOne"
								aria-expanded="false" aria-controls="collapseOne">Example Searches</a>
							</div>
							<div id="collapseOne" aria-labelledby="headingOne" class="collapse" >
								<div style="font-style:italic;padding:0px 5px;">
								<a href="#" onclick="$('#search_term').val('NRIP1');d3.select('#svg-container').selectAll('*').remove();doSearch();return false;">NRIP1</a>,
								<a href="#" onclick="$('#search_term').val('ENSG00000134460');d3.select('#svg-container').selectAll('*').remove();doSearch();return false;">ENSG00000134460</a>,
								<a href="#" onclick="$('#search_term').val('rs2476601');d3.select('#svg-container').selectAll('*').remove();doSearch();return false;">rs2476601</a>,
								<a href="#" onclick="$('#search_term').val('chr16:10,000,000-11,500,000');d3.select('#svg-container').selectAll('*').remove();doSearch();return false;">chr16:10,000,000-11,500,000</a>
								</div>
							</div>
						</div>
					</div>
					<div class="panel panel-default" style="margin-top: 20px">
						<div class="panel-heading">Capture HiC Datasets
						<span class="fa-stack fa-lg" style="float:right;font-size:0.8em">
							<i class="fa fa-circle-thin fa-stack-2x"></i>
							<i class="fa fa-stack-1x">4</i>
						</span>
						</div>
						<div class="panel-body">
							<div class="form-group" style="width:100%">
								<select class="form-control targets" name="target" id="target" onchange="switch_targets(this)" style="width:100%">
						
									<option id="target-CHICAGO" value="CHICAGO">Javierre et al.</option>
						
									<option id="target-MIFSUD" value="MIFSUD">Mifsud et al.</option>
						
									<option id="target-MIGUEL" value="MIGUEL">Miguel-Escalada et al.</option>
						
									<option id="target-CHOY" value="CHOY">Choy et al.</option>
						
								</select>
							</div>
							<div class="form-group" style="padding-top:10px;">
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Endothelial_precursors"
									 checked="checked"
									>&nbsp;Endothelial precursors&nbsp;<span id="Endothelial_precursors_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Erythroblasts"
									
									>&nbsp;Erythroblasts&nbsp;<span id="Erythroblasts_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Foetal_thymus"
									
									>&nbsp;Foetal thymus&nbsp;<span id="Foetal_thymus_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Macrophages_M0"
									
									>&nbsp;Macrophages M0&nbsp;<span id="Macrophages_M0_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Macrophages_M1"
									
									>&nbsp;Macrophages M1&nbsp;<span id="Macrophages_M1_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Macrophages_M2"
									
									>&nbsp;Macrophages M2&nbsp;<span id="Macrophages_M2_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Megakaryocytes"
									
									>&nbsp;Megakaryocytes&nbsp;<span id="Megakaryocytes_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Monocytes"
									
									>&nbsp;Monocytes&nbsp;<span id="Monocytes_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Naive_B"
									
									>&nbsp;Naive B&nbsp;<span id="Naive_B_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Naive_CD4"
									
									>&nbsp;Naive CD4&nbsp;<span id="Naive_CD4_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Naive_CD8"
									
									>&nbsp;Naive CD8&nbsp;<span id="Naive_CD8_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Neutrophils"
									
									>&nbsp;Neutrophils&nbsp;<span id="Neutrophils_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Total_B"
									
									>&nbsp;Total B&nbsp;<span id="Total_B_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Total_CD4_Activated"
									
									>&nbsp;Total CD4 Activated&nbsp;<span id="Total_CD4_Activated_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Total_CD4_MF"
									
									>&nbsp;Total CD4 MF&nbsp;<span id="Total_CD4_MF_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Total_CD4_NonActivated"
									
									>&nbsp;Total CD4 NonActivated&nbsp;<span id="Total_CD4_NonActivated_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHICAGO" style="display: none">
									<label><input type="radio" name="tissue" value="Total_CD8"
									
									>&nbsp;Total CD8&nbsp;<span id="Total_CD8_count">(0)</span></label>
								</div>
					
								<div class="radio tissue MIFSUD" style="display: none">
									<label><input type="radio" name="tissue" value="CD34"
									
									>&nbsp;CD34&nbsp;<span id="CD34_count">(0)</span></label>
								</div>
					
								<div class="radio tissue MIFSUD" style="display: none">
									<label><input type="radio" name="tissue" value="GM12878"
									
									>&nbsp;GM12878&nbsp;<span id="GM12878_count">(0)</span></label>
								</div>
					
								<div class="radio tissue MIGUEL" style="display: none">
									<label><input type="radio" name="tissue" value="Pancreatic_Islets"
									
									>&nbsp;Pancreatic Islets&nbsp;<span id="Pancreatic_Islets_count">(0)</span></label>
								</div>
					
								<div class="radio tissue CHOY" style="display: none">
									<label><input type="radio" name="tissue" value="hESC_Derived_Cardiomyocytes"
									
									>&nbsp;hESC Derived Cardiomyocytes&nbsp;<span id="hESC_Derived_Cardiomyocytes_count">(0)</span></label>
								</div>
					
							</div>
						</div>
					</div>
					<div class="panel panel-default" style="margin-top: 20px;">
						<div class="panel-heading">Association Studies</div>
						<div class="panel-body">
						
						<p>To view these data please login via the button in the top right-hand corner.</p>
						
						</div>
					</div>
				</ul>

			</div>

			<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
				
				<div class="row">
					<div class="col-xs-12 col-md-8 col-lg-6">
						<h1 class="page_header" id="page_header"></h1>
					</div>

					<div class="col-xs-12 col-md-4 col-lg-6">

						<span class="pull-right no-print">
							<button class="btn btn-primary" id="save_as_svg" value="">
								<i class="fa fa-floppy-o"></i>&nbsp;SVG
							</button>
							<button class="btn btn-primary" id="save_as_pdf" value="">
								<i class="fa fa-floppy-o"></i>&nbsp;PDF
							</button>
							<button class="btn btn-primary" id="save_as_png" value="">
								<i class="fa fa-floppy-o"></i>&nbsp;PNG
							</button>
						</span>
					</div>
				</div>
				<ol class="breadcrumb no-print" id="breadcrumb">
					<li><a href="/chicp/">Start</a></li>
				</ol>
				<div id="svg-row" class="row svg-row" style="max-height:720px;">
					<div class="col-sm-12 col-lg-6">
						<div id="svg-container"></div>
					</div>
					<div class="col-sm-12 col-lg-6">
						<div class="row">
							<div class="col-sm-12">
								<div class="panel panel-info">
									<div class="panel-heading">
									<span id="footer-bait" style="font-size:0.9em; font-style:italic; float:right">&nbsp;</span>
										<h3 class="panel-title">Bait</h3>
									</div>
									<div style="height: 300px;" class="panel-body panel-seq" id="panel-bait"></div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<div class="panel panel-danger">
									<div class="panel-heading">
										<span id="footer-target" style="font-size: 0.9em; font-style: italic; float:right">&nbsp;</span>
										<h3 class="panel-title">Target</h3>
									</div>
									<div style="height: 300px;" class="panel-body panel-seq" id="panel-target"></div>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>
			
		</div>
	</div>
	
	<div id="ContactModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
	        		<h3 class="modal-title" id="myModalLabel">Contact Us</h3>
	        	</div>
	
				<form id="contact-form">					
				<div class="modal-body">
						<div class="form-group">
							<label>Name</label>
							<input name="contact-name" value="" class="form-control required" placeholder="Your Name" data-validation="length" data-validation-length="min3" type="text">
						</div>
						<div class="form-group">
							<label>E-Mail</label>
							<input name="contact-email" class="form-control email" placeholder="Your E-mail" type="text" data-validation="email">
						</div>
						<div class="form-group">
							<label>Message</label>
							<textarea name="contact-msg" rows="6" class="form-control" placeholder="Your Message" data-validation="required"></textarea>
						</div>
						<div class="g-recaptcha" data-sitekey="6LdpOBATAAAAAFwGyYPXqDlMTNpiC0F9wq4L8O7U"></div>
						<input type='hidden' name='csrfmiddlewaretoken' value='GgU0h0bIa6NsuwTB7AOjervaXZMOiEFn' />
				</div>
				
				<div class="modal-footer">
					<div class="btn-group btn-group-justified" role="group" aria-label="group button">
						<div class="btn-group" role="group">
							<button type="button" id="sendEmail" class="btn btn-success" data-action="save" role="button">Send</button>
						</div>
						<div class="btn-group" role="group">
							<button type="button" class="btn btn-default" data-dismiss="modal" role="button">Close</button>
						</div>
					</div>
				</div>
				</form>
			
			</div>
		</div>
	</div>
	
	
	<!-- line modal -->
	<div class="modal fade" id="settingsModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
					<h3 class="modal-title" id="lineModalLabel">CHiCP Settings</h3>
				</div>

				<div class="modal-body">
					<!-- content goes here -->
					<span id="scoreSliderValLabel">Interaction Score:&nbsp;</span><input id="scoreSliderInput" type="text" />&nbsp;<span id="scoreSliderVal">5</span>
					
				</div>

				<div class="modal-footer">
					<div class="btn-group btn-group-justified" role="group" aria-label="group button">
						<div class="btn-group" role="group">
							<button type="button" id="saveSettings" class="btn btn-primary" data-action="save" role="button">Save</button>
						</div>
						<div class="btn-group" role="group">
							<button type="button" class="btn btn-default" data-dismiss="modal" role="button">Close</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Hidden <FORM> to submit the SVG data to the server, which will convert it to SVG/PDF/PNG downloadable file.
		The form is populated and submitted by the JavaScript below. -->
	<form id="svgform" method="post" action="/chicp/download">
		<input type='hidden' name='csrfmiddlewaretoken' value='GgU0h0bIa6NsuwTB7AOjervaXZMOiEFn' />
		<input type="hidden" id="output_format" name="output_format" value="">
		<input type="hidden" id="data-main" name="data-main" value="">
		<input type="hidden" id="data-bait" name="data-bait" value="">
		<input type="hidden" id="data-target" name="data-target" value="">
		<input type="hidden" id="svg-width" name="svg-width" value="">
		<input type="hidden" id="svg-height" name="svg-height" value="">
		<input type="hidden" id="searchTerm" name="searchTerm" value="">
		<input type="hidden" id="tissue" name="tissue" value="">
		<input type="hidden" id="snp_track" name="snp_track" value="">
		<input type="hidden" id="css-styles" name="css-styles" value="">
		<input type="hidden" id="totalBP" name="totalBP" value="">
		<input type="hidden" id="region" name="region" value="">
		<input type="hidden" id="maxScore" name="maxScore" value="">
	</form>

	
	<!-- Bootstrap core JavaScript
		================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src='https://www.google.com/recaptcha/api.js'></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="//cdn.datatables.net/1.10.8/js/jquery.dataTables.min.js"></script>
	<script src="//cdn.datatables.net/responsive/1.0.7/js/dataTables.responsive.min.js"></script>
	<script src="//cdn.datatables.net/1.10.8/js/dataTables.bootstrap.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-form-validator/2.2.8/jquery.form-validator.min.js"></script>		
	
	<script type="text/javascript" src="/static/chicp/js/tipsy.684916a56e5b.js"></script>
	<script type="text/javascript" src="/static/chicp/js/jquery.isloading.4846ccfcce85.js"></script>
	<script type="text/javascript" src="/static/chicp/js/bootstrap.fd.f199bd432719.js"></script>
	<script type="text/javascript" src="/static/chicp/js/jquery.cookie.0f1f6cd6e003.js"></script>
	<script type="text/javascript" src="/static/chicp/js/jquery.cookiebar.553f92b35d45.js"></script>
	<script type="text/javascript" src="/static/chicp/js/bootstrap-slider.fe0e75eb4935.js"></script>
	<script type="text/javascript" src="/static/chicp/js/hic-vis.23567562e7fb.js"></script>
	<script type="text/javascript">
		function styles() {
			var used = "";
			var sheets = document.styleSheets;
			for (var i = 0; i < sheets.length; i++) {
				if (sheets[i].href == null || sheets[i].href.match(window.location.hostname)){
					var rules = sheets[i].cssRules;
					for (var j = 0; j < rules.length; j++) {
						var rule = rules[j];
						if ('undefined' !== typeof rule.selectorText && rule.selectorText.match(/^svg/)){
							used += rule.selectorText + " { "+ rule.style.cssText + " }\n";
						}
					}
				}
			}

			var s = document.createElement('style');
			s.setAttribute('type', 'text/css');
			s.innerHTML = "<![CDATA[\n" + used + ".svg_only{ display:inline; }\n.svg_hide{ display:none }\n]]>";

			return s.innerHTML;
		}

		function submit_download_form(output_format) {
			baitSVG = "";
			targetSVG = "";
			svgWidth = $("#main-svg").width()
			//svgHeight = $("#main-svg").height()
			svgHeight = $("#svg-row").height()

			if ($("svg").length == 3) {
				baitSVG = (new XMLSerializer).serializeToString($("#bait-svg")[0]);
				targetSVG = (new XMLSerializer).serializeToString($("#target-svg")[0]);
				svgWidth += $("#panel-bait").width();
				svgHeight2 = $("#panel-bait").height() + $("#panel-target").height()
				if (svgHeight2 > svgHeight)
					svgHeight = svgHeight2
			}

			// Submit the <FORM> to the server.
			// The result will be an attachment file to download.
			$("#output_format").val(output_format);
			$("#data-main").val((new XMLSerializer).serializeToString($("#main-svg")[0]));
			$("#data-bait").val(baitSVG);
			$("#data-target").val(targetSVG);
			$("#svg-width").val(svgWidth);
			$("#svg-height").val(svgHeight);
			$("#searchTerm").val($("#search_term").val());
			$("#tissue").val($("input:radio[name=tissue]:checked").val());
			$("#snp_track").val($("#gwas").val());
			$("#css-styles").val(styles());
			$("#svgform").submit();
		}
		function switch_snp_track(selectObj) {
			var region = $("#region").val();
			var term = $("#search_term").val();
			var tissue = $("input:radio[name=tissue]:checked").val();
			var gwas = selectObj.options[selectObj.selectedIndex].value;
			var targetIdx = $("#target")[0].options[$("#target")[0].selectedIndex].value;
			localStorage["snp_track"] = gwas;

			$.isLoading({ text: "Loading" });
			d3.json("/chicp/search?searchTerm="+term+"&region=" + region + '&targetIdx='+targetIdx+'&tissue=' + tissue + '&snp_track=' + gwas, function (error, data) {
				d3.select("#message").remove();
				if (error) {$.isLoading( "hide" ); console.warn(error);return;}

				d3.select("#svg-container").selectAll(".snp").remove();
				d3.select("#svg-container").selectAll(".deleteSearch").remove();
	    		resetVis();

				if (data.error) {
					$.isLoading( "hide" );
					div = d3.select("#svg-container")
						.insert("div",":first-child")
						.html("<h1>"+data.error+"</h1>")
						.attr("id", "message")
						.style("width", "100%")
						.style("text-align", "center");
					return;
				}

				d3.select("#svg-container").selectAll(".track.snps").remove();
		        var totalBP = data.meta.rend - data.meta.rstart;
		        META = data.meta;
				addSNPTrack(data.snps, data.snp_meta);
		        addSNPTrackPoints(data.snps, data.snp_meta, totalBP);
		        $("#snp_track_header").html("SNP Data: "+$('#gwas option:selected').text());
		        $.isLoading( "hide" );
			});
		}
		function switch_targets (selectObj) {
			var target = selectObj.options[selectObj.selectedIndex].value;
			$(".tissue").hide();
			$(document.getElementsByClassName(target)).css('display', 'block');
			$(".tissue").find("input:radio").each(function () { $(this).prop('checked', false); });
			$(document.getElementsByClassName(target)).first().find("input:radio").prop('checked',true);

			var region = $("#region").val();
			var term = $("#search_term").val();
			var tissue = $("input:radio[name=tissue]:checked").val();
			var gwas = $("#gwas").val();

	        $(".page-header").html(term + " in " + tissue.replace(/_/g, " ") + " Tissues");
	        // $(".page-header").html(term + " in " + tissue.replace(/_/g, " ") + " Tissues");

			localStorage["tissue"] = tissue
			localStorage["target"] = target
      url = "/chicp/search?searchTerm=" + term + '&tissue=' + tissue+'&targetIdx='+target+"&region=" + region;
    	if (gwas != "" && gwas !==null && gwas !==undefined) url += '&snp_track=' + gwas;
			$.isLoading({ text: "Loading" });
			// d3.json("/chicp/search?searchTerm="+term+"&region=" + region + '&targetIdx='+target+'&tissue=' + tissue + '&snp_track=' + gwas, function (error, data) {
      d3.json(url, function (error, data) {
				if (error) {$.isLoading( "hide" ); console.warn(error); return}
				d3.select("#svg-container").selectAll(".middle.hic").remove();
				d3.select("#svg-container").selectAll(".deleteSearch").remove();
	    		resetVis();

				if (data.error) {
					$.isLoading( "hide" );
					d3.select("#svg-container").selectAll("*").remove();
					div = d3.select("#svg-container")
						.append("div")
						.html("<h1>"+data.error+"</h1>")
						.attr("id", "message")
						.attr("class", "chicp_msg");
					return;
				}

		        var totalBP = data.meta.rend - data.meta.rstart;
		        META = data.meta;
		        var hics = data.hic;
				if (hics.length == 0) {
					d3.select("#svg-container").selectAll("*").remove();
					div = d3.select("#svg-container")
						.append("div")
						.html("<h1>No interactions found</h1>")
						.attr("id", "message")
						.attr("class", "chicp_msg");
			        $.isLoading( "hide" );
					return;
				}
				for (var i = 0; i < hics.length; i++) {
				    hics[i].id = i + 1;
				}
				var tissues = [];
				for (var i=0;i<META.tissues.length;i++) {
					tissues[META.tissues[i]] = 0;
				}
				if (d3.select("#main-svg").empty())
					doSearch();
				else
		        	addInteractions(hics, totalBP, tissues);
				for(var t in tissues) {
					$("#"+t+"_count").text("("+tissues[t]+")");
				}
		        $.isLoading( "hide" );
			});
		}
		$(document).ready(function() {

			localStorage["interactionScore"] = localStorage["interactionScore"] || 5;
			var interactionScore = localStorage["interactionScore"];

			// Interaction Score Slider
			$("#scoreSliderVal").text(localStorage["interactionScore"])
			$("#scoreSliderInput").slider({ id: "scoreSlider", value: parseInt(localStorage["interactionScore"]), min: 0, max: 20, step: 0.5 });
			$("#scoreSliderInput").on("slide", function(slideEvt) {
				$("#scoreSliderVal").text(slideEvt.value);
			});

			$("#saveSettings").click(function() {
				localStorage["interactionScore"] = $("#scoreSliderInput").val();
				renderVis();
				$('#settingsModal').modal('hide');
			});

			$(document).on("click", ".deleteUD", function(e){
				file = $(this).text();
				id = this.id
				var r = confirm("Are you sure you want to delete"+file+"?");
				if (r == true) {
					$.isLoading({ text: "Loading" });
	                var formData = new FormData();
	                formData.append("userDataIdx", id.replace('ud-',''));
	                formData.append("csrfmiddlewaretoken", "GgU0h0bIa6NsuwTB7AOjervaXZMOiEFn");
					$.ajax({
	                	url: "deleteUserData",
	                	type: "POST",
	                	data: formData,
	                	processData: false,  // tell jQuery not to process the data
	                	contentType: false,   // tell jQuery not to set contentType
	                	success: function(data){
	                		if(data.acknowledged){
	                			// localStorage.removeItem(id);
	                			optGroup = $("#userData");
	                			optGroup.find('option[value="'+id+'"]').remove();
	                			userSettings = $("#userSettings");
	                			userSettings.find('li#'+id).remove();
	                		}
	        		        $.isLoading( "hide" );
	                	},
	                	error: function(e){
	        		        $.isLoading( "hide" );
	                	}
	                });
				}
			});


			$("#save_as_svg").click(function() {
				submit_download_form("svg");
			});
			$("#save_as_pdf").click(function() {
				submit_download_form("pdf");
			});
			$("#save_as_png").click(function() {
				submit_download_form("png");
			});
			// TODO need a variable for max filesize and perhaps server side checking
			// write a function to ouput error messages to main SVG area
			$("#open_btn").click(function() {
				$.FileDialog({multiple: false, dropheight: 200, accept: ".bed"}).on('files.bs.filedialog', function(ev) {

					$.isLoading({ text: "Loading" });
	                var files = ev.files;
	                var action = $("#fileUpload").attr('action')
	                var oversized = 0;
	                var formData = new FormData();
	                // check here if file is too big
	                files.forEach(function(f) {
	                	console.log(f.size)
	                	if(f.size > 2e6){
	                		d3.select("#svg-container").selectAll("*").remove();
							div = d3.select("#svg-container")
							.append("div")
							.html("<h1>File should be smaller than 2Mb</h1>")
							.attr("id", "message")
							.attr("class", "chicp_msg");
	                		$.isLoading( "hide");
	                		oversized = 1;
	                	}

	                	formData.append('files[]', f);
	                });
	                console.log("Oversized is " + oversized);
	                if(oversized == 1){
	                	return true
	                }
	                formData.append("csrfmiddlewaretoken", "GgU0h0bIa6NsuwTB7AOjervaXZMOiEFn")

	                $.ajax({
	                	url: action,
	                	type: "POST",
	                	data: formData,
	                	processData: false,  // tell jQuery not to process the data
	                	contentType: false,   // tell jQuery not to set contentType
	                	success: function(data){
	                		optGroup = $("#userData");
	                		userSettings = $("#userSettings");
	                		if(data.error !=200){
	                			console.log(data.errorMsg)
	                			d3.select("#svg-container").selectAll("*").remove();
								div = d3.select("#svg-container")
								.append("div")
								.html("<h1>"+data.errorMsg+"</h1>")
								.attr("id", "message")
								.attr("class", "chicp_msg");
	                			$.isLoading( "hide");
	                			return true;
	                		}else{
	                			for (i = 0; i < data.userSNPTracks.length; i++) {
	                				f = data.userSNPTracks[i]
	                				// localStorage[f.value] = f.text
	                				optGroup.append('<option value="'+f.value+'">'+f.text+'</option>');
	                				userSettings.append('<li class="deleteUD" id="'+f.value+'">'+
	                				'<i class="fa fa-trash-o" id="DEL-'+f.value+'"></i>&nbsp;'+f.text+'</li>');
	                			}
	        		        	$.isLoading( "hide" );
	        		        }
	                	},
	                	error: function(e){
	                		// perhaps throw an error ?
	        		        $.isLoading( "hide" );
	                	}
	                });
	            }).on('cancel.bs.filedialog', function(ev) {
	            	console.log("Cancelled!")
	            });
			});

			if (localStorage["target"] != undefined && $("#target-"+localStorage["target"]) != undefined){
				$("#target > option").each(function() {
					$(this).prop("selected", false)
				});
				$("#target-"+localStorage["target"]).prop("selected", "selected")
			}

			selectObj = $("#target")[0]
			var target = selectObj.options[selectObj.selectedIndex].value;
			$(".tissue").hide();
			$(document.getElementsByClassName(target)).css('display', 'block');
			$(".tissue").find("input:radio").each( function () {
				if (localStorage["tissue"] !== "undefined" && $(this).val() == localStorage["tissue"])
					$(this).prop('checked', true);
				else if ($(this).val() == "Endothelial_precursors" && localStorage["tissue"] == "undefined")
					$(this).prop('checked', true);
				else
					$(this).prop('checked', false);
				});

			$.cookieBar({
				message: 'Some data on this website are only available after acceptance of our <a style="padding:0px; margin:0px;" href="https://www.immunobase.org/page/Copyright" title="read our data access agreement" target="_blank">data access agreement</a> and cookies.',
				fixed: true,
				bottom: true,
				acceptButton: true,
				acceptText: 'Accept',
				declineButton: true,
				declineText: 'Decline',
				autoEnable: false,
				acceptFunction: function(cookieValue){ switch_snp_track($("#gwas")[0]); },
				zindex: 100,
			});

			if (getQueryVariable("term") != undefined){ $("#search_term").val(getQueryVariable("term")); }
			else if (localStorage.getItem("searchTerm")) { $("#search_term").val(localStorage.getItem("searchTerm")) }
			doSearch();

		});
	</script>

	<script> $.validate(); </script>
	<script>
		$(document).ready(function () {
			$("#sendEmail").click(function(){
				$.ajax({
					type: "POST",
					url: "/contact",
					data: $('form#contact-form').serialize(),
					success: function(msg){
						$("#ContactModal").modal('hide');	
					},
					error: function(obj, status){
						console.log(status);
					}
				});
			});
		});
    </script>
		
</body>
</html>
