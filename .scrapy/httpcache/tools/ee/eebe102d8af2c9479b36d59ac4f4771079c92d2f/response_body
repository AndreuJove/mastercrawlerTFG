<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ChromContact</title>
<link href="style.css" rel="stylesheet" type="text/css" />
<link href="jquery-ui.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery-1.11.3.min.js" ></script>
<script type="text/javascript" src="jquery-ui.min.js" ></script>
<script type="text/javascript">


var cell1;
var cell1_res;
var cell2;
var cell2_res;
var cell3;
var cell3_res;
var cell4;
var cell4_res;
var cell5;
var cell5_res;
var cell6;
var cell6_res;
var key = $('#key').val();
var upload = $('#upload').val();


$(function(){




	function getStatus()
	{
		cell1 = $('#cell1').is(':checked');
		cell1_res = $('#resolution1').val();
		cell2 = $('#cell2').is(':checked');
		cell2_res = $('#resolution2').val();
		cell3 = $('#cell3').is(':checked');
		cell3_res = $('#resolution3').val();
		cell4 = $('#cell4').is(':checked');
		cell4_res = $('#resolution4').val();
		cell5 = $('#cell5').is(':checked');
		cell5_res = $('#resolution5').val();
		cell6 = $('#cell6').is(':checked');
		cell6_res = $('#resolution6').val();
		key = $('#key').val();
		upload = $('#upload').val();
	}


	$('div.add').click(function(){
		$('div#options_table').toggle();
		if( $('div#options_table').css('display') == "none")
		{
			$('div.btn.add img').attr('src', 'images/btn_add.png');
		}
		else
		{
			$('div.btn.add img').attr('src', 'images/btn_remove.png');
		}
	});
	
	
	var file = "";

	if(file != "")
	{


			getStatus();

			var url = 'key2chrpos.php?file=' + file;
			
			$.getJSON(url, function(data){
				var result = "";
				var result_body = "\r\n<li class='li_title_header'>Genome position</li><li class='li_ucsc_header'>Browser</li><li class='li_btn_header'>Download in Text</li>";
				var count = 0;
				for(single_record in data)
				{
					if(data[single_record].toLowerCase().indexOf("error") != -1 )
					{
					}
					else if(data[single_record].toLowerCase().indexOf("multiple") != -1 )
					{
					}
					else
					{
						count = count + 1;

						single_data = data[single_record];
						if(single_data.toLowerCase() != key)
						{
							single_data = single_data.toLowerCase().replace(key, '');
						}
						result_body = result_body + "\r\n<li class='li_title'><strong>" + count + "</strong>:  <span>" + single_data  + "</span></li>"
														+ "<li class='li_ucsc'><a target='_blank' href='ucsc.php?key="+ single_data +"&cell1="+ cell1 +"&cell1_res="+ cell1_res + "&cell2="+ cell2 +"&cell2_res="+ cell2_res + "&cell3="+ cell3 +"&cell3_res="+ cell3_res + "&cell4="+ cell4 +"&cell4_res="+ cell4_res +"&cell5="+ cell5 + "&cell5_res="+ cell5_res  +"&cell6="+ cell6 +"&cell6_res="+ cell6_res +"'>UCSC Genome Browser</a></li>";
			
														
						if(cell1 == true)
						{								
							result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell1="+ cell1 +"&cell1_res="+ cell1_res + "&cell2="+ cell2 +"&cell2_res="+ cell2_res + "&cell3="+ cell3 +"&cell3_res="+ cell3_res + "&cell4="+ cell4 +"&cell4_res="+ cell4_res +"&cell5="+ cell5 + "&cell5_res="+ cell5_res  +"&cell6="+ cell6 +"&cell6_res="+ cell6_res +"'>GM12878</a></li>";
						}
						else
						{
							result_body = result_body + "<li class='li_btn'><span>GM12878</span></li>";							
						}

						if(cell2 == true)
						{								
							result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell2=true&cell2_res="+ cell2_res +"'>IMR90</a></li>";
						}
						else
						{
							result_body = result_body + "<li class='li_btn'><span>IMR90</span></li>";							
						}

						if(cell3 == true)
						{								
							result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell3=true&cell3_res="+ cell3_res +"'>HMEC</a></li>";
						}
						else
						{
							result_body = result_body + "<li class='li_btn'><span>HMEC</span></li>";							
						}

						if(cell4 == true)
						{								
							result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell4=true&cell4_res="+ cell4_res +"'>K562</a></li>";
						}
						else
						{
							result_body = result_body + "<li class='li_btn'><span>K562</span></li>";							
						}

						if(cell5 == true)
						{								
							result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell5=true&cell5_res="+ cell5_res +"'>NHEK</a></li>";
						}
						else
						{
							result_body = result_body + "<li class='li_btn'><span>NHEK</span></li>";							
						}

						if(cell6 == true)
						{								
							result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell6=true&cell6_res="+ cell6_res +"'>HUVEC</a></li>";
						}
						else
						{
							result_body = result_body + "<li class='li_btn'><span>HUVEC</span></li>";							
						}
						
						/* zip download */
						result_body = result_body + "<li class='li_btn last'><a href='download.php?mode=zip&key="+ single_data +"&cell1="+ cell1 +"&cell1_res="+ cell1_res + "&cell2="+ cell2 +"&cell2_res="+ cell2_res + "&cell3="+ cell3 +"&cell3_res="+ cell3_res + "&cell4="+ cell4 +"&cell4_res="+ cell4_res +"&cell5="+ cell5 + "&cell5_res="+ cell5_res  +"&cell6="+ cell6 +"&cell6_res="+ cell6_res + "'>All in ZIP</a></li>";

						if ( (count % 50) == 0)
						{
							result_body = result_body + "<li class='goback'><a href='#'>Back to Top</a></li>";
						}
						


					}
				}

				if(data[0].indexOf("no_hits_found") == -1)
				{
					result = "<li class='result_highlight'>" + count + " hit(s) found.";
					result = result + "<br />Select one of the following genomic coordinates:";
				}
				else
				{
					result = "<li class='result_highlight'>No hit found.";
				}
				result = result + "</li>" + result_body;	
				result = result + "<li class='goback'><a href='#'>Back to Top</a></li>";

				$('ul#search_result').animate({'height': '300px','overflow-y':'scroll'}, 500);
				$('ul#search_result').html(result);
			})		
		
	}
	
	
	$('#key').keypress(function(e){
		if(e.which === 13) {


			getStatus();
	
			if(key == "" && upload == "")
			{
				alert('Please input at least one keyword.');	
			}
			else
			{
				var url = 'key2chrpos.php?key=' + key;
				
				$.getJSON(url, function(data){
					var result = "";
					var result_body = "\r\n<li class='li_title_header'>Genome position</li><li class='li_ucsc_header'>Browser</li><li class='li_btn_header'>Download in Text</li>";
					var count = 0;
					for(single_record in data)
					{
						if(data[single_record].toLowerCase().indexOf("error") != -1 )
						{
						}
						else if(data[single_record].toLowerCase().indexOf("multiple") != -1 )
						{
						}
						else
						{
							count = count + 1;
	
							single_data = data[single_record];
							if(single_data.toLowerCase() != key)
							{
								single_data = single_data.toLowerCase().replace(key, '');
							}
	
	
							result_body = result_body + "\r\n<li class='li_title'><strong>" + count + "</strong>:  <span>" + single_data  + "</span></li>"
															+ "<li class='li_ucsc'><a target='_blank' href='ucsc.php?key="+ single_data +"&cell1="+ cell1 +"&cell1_res="+ cell1_res + "&cell2="+ cell2 +"&cell2_res="+ cell2_res + "&cell3="+ cell3 +"&cell3_res="+ cell3_res + "&cell4="+ cell4 +"&cell4_res="+ cell4_res +"&cell5="+ cell5 + "&cell5_res="+ cell5_res  +"&cell6="+ cell6 +"&cell6_res="+ cell6_res +"'>UCSC Genome Browser</a></li>";
															
							if(cell1 == true)
							{								
								result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell1="+ cell1 +"&cell1_res="+ cell1_res +"'>GM12878</a></li>";
							}
							else
							{
								result_body = result_body + "<li class='li_btn'><span>GM12878</span></li>";							
							}
	
							if(cell2 == true)
							{								
								result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell2=true&cell2_res="+ cell2_res +"'>IMR90</a></li>";
							}
							else
							{
								result_body = result_body + "<li class='li_btn'><span>IMR90</span></li>";							
							}
	
							if(cell3 == true)
							{								
								result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell3=true&cell3_res="+ cell3_res +"'>HMEC</a></li>";
							}
							else
							{
								result_body = result_body + "<li class='li_btn'><span>HMEC</span></li>";							
							}
	
							if(cell4 == true)
							{								
								result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell4=true&cell4_res="+ cell4_res +"'>K562</a></li>";
							}
							else
							{
								result_body = result_body + "<li class='li_btn'><span>K562</span></li>";							
							}
	
							if(cell5 == true)
							{								
								result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell5=true&cell5_res="+ cell5_res +"'>NHEK</a></li>";
							}
							else
							{
								result_body = result_body + "<li class='li_btn'><span>NHEK</span></li>";							
							}
	
							if(cell6 == true)
							{								
								result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell6=true&cell6_res="+ cell6_res +"'>HUVEC</a></li>";
							}
							else
							{
								result_body = result_body + "<li class='li_btn'><span>HUVEC</span></li>";							
							}
							
							
							/* zip download */
							result_body = result_body + "<li class='li_btn last'><a href='download.php?mode=zip&key="+ single_data +"&cell1="+ cell1 +"&cell1_res="+ cell1_res + "&cell2="+ cell2 +"&cell2_res="+ cell2_res + "&cell3="+ cell3 +"&cell3_res="+ cell3_res + "&cell4="+ cell4 +"&cell4_res="+ cell4_res +"&cell5="+ cell5 + "&cell5_res="+ cell5_res  +"&cell6="+ cell6 +"&cell6_res="+ cell6_res + "'>All in ZIP</a></li>";
							
							
	
							if ( (count % 50) == 0)
							{
								result_body = result_body + "<li class='goback'><a href='#'>Back to Top</a></li>";
							}
							
	
						}
					}
	
					if(data[0].indexOf("no_hits_found") == -1)
					{
						result = "<li class='result_highlight'>" + count + " hit(s) found.";
						result = result + "<br />Select one of the following genomic coordinates:";
					}
					else
					{
						result = "<li class='result_highlight'>No hit found.";
					}
					result = result + "</li>" + result_body;	
					result = result + "<li class='goback'><a href='#'>Back to Top</a></li>";

					$('ul#search_result').animate({'height': '300px','overflow-y':'scroll'}, 200);
					$('ul#search_result').html(result);
				});
			}
			
			var position = $('#search_result').offset().top;
    	  	$('body,html').animate({scrollTop:position}, 1000, 'swing');
		}
	});


	$('#search_button').click(function(){


		getStatus();

		if(key == "" && upload == "")
		{
			alert('Please input at least one keyword.');	
		}
		else if(upload != "")
		{
			$('form#searchform').attr('enctype', "multipart/form-data");
			$('form#searchform').attr('method', "post");
			$('form#searchform').attr('action', "upload.php");
			$('form#searchform').submit();	
		}
		else
		{
			var url = 'key2chrpos.php?key=' + key;
			
			$.getJSON(url, function(data){
				var result = "";
				var result_body = "\r\n<li class='li_title_header'>Genome position</li><li class='li_ucsc_header'>Browser</li><li class='li_btn_header'>Download in Text</li>";
				var count = 0;
				for(single_record in data)
				{
					if(data[single_record].toLowerCase().indexOf("error") != -1 )
					{
					}
					else if(data[single_record].toLowerCase().indexOf("multiple") != -1 )
					{
					}
					else
					{
						count = count + 1;

						single_data = data[single_record];
						if(single_data.toLowerCase() != key)
						{
							single_data = single_data.toLowerCase().replace(key, '');
						}


						result_body = result_body + "\r\n<li class='li_title'><strong>" + count + "</strong>:  <span>" + single_data  + "</span></li>"
														+ "<li class='li_ucsc'><a target='_blank' href='ucsc.php?key="+ single_data +"&cell1="+ cell1 +"&cell1_res="+ cell1_res + "&cell2="+ cell2 +"&cell2_res="+ cell2_res + "&cell3="+ cell3 +"&cell3_res="+ cell3_res + "&cell4="+ cell4 +"&cell4_res="+ cell4_res +"&cell5="+ cell5 + "&cell5_res="+ cell5_res  +"&cell6="+ cell6 +"&cell6_res="+ cell6_res +"'>UCSC Genome Browser</a></li>";
														
						if(cell1 == true)
						{								
							result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell1=true&cell1_res="+ cell1_res +"'>GM12878</a></li>";
						}
						else
						{
							result_body = result_body + "<li class='li_btn'><span>GM12878</span></li>";							
						}

						if(cell2 == true)
						{								
							result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell2=true&cell2_res="+ cell2_res +"'>IMR90</a></li>";
						}
						else
						{
							result_body = result_body + "<li class='li_btn'><span>IMR90</span></li>";							
						}

						if(cell3 == true)
						{								
							result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell3=true&cell3_res="+ cell3_res +"'>HMEC</a></li>";
						}
						else
						{
							result_body = result_body + "<li class='li_btn'><span>HMEC</span></li>";							
						}

						if(cell4 == true)
						{								
							result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell4=true&cell4_res="+ cell4_res +"'>K562</a></li>";
						}
						else
						{
							result_body = result_body + "<li class='li_btn'><span>K562</span></li>";							
						}

						if(cell5 == true)
						{								
							result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell5=true&cell5_res="+ cell5_res +"'>NHEK</a></li>";
						}
						else
						{
							result_body = result_body + "<li class='li_btn'><span>NHEK</span></li>";							
						}

						if(cell6 == true)
						{								
							result_body = result_body + "<li class='li_btn'><a href='download.php?key="+ single_data +"&cell6=true&cell6_res="+ cell6_res +"'>HUVEC</a></li>";
						}
						else
						{
							result_body = result_body + "<li class='li_btn'><span>HUVEC</span></li>";							
						}
						
						
						
						/* zip download */
						result_body = result_body + "<li class='li_btn last'><a href='download.php?mode=zip&key="+ single_data +"&cell1="+ cell1 +"&cell1_res="+ cell1_res + "&cell2="+ cell2 +"&cell2_res="+ cell2_res + "&cell3="+ cell3 +"&cell3_res="+ cell3_res + "&cell4="+ cell4 +"&cell4_res="+ cell4_res +"&cell5="+ cell5 + "&cell5_res="+ cell5_res  +"&cell6="+ cell6 +"&cell6_res="+ cell6_res + "'>All in ZIP</a></li>";

						
						
						if (count % 50 == 0)
						{
							result_body = result_body + "<li class='goback'><a href='#'>Back to Top</a></li>";
						}
						

					}
					
					
					
				}

				if(data[0].indexOf("no_hits_found") == -1)
				{
					result = "<li class='result_highlight'>" + count + " hit(s) found.";
					result = result + "<br />Select one of the following genomic coordinates:";
				}
				else
				{
					result = "<li class='result_highlight'>No hit found.";
				}
				result = result + "</li>" + result_body;	
				result = result + "<li class='goback'><a href='#'>Back to Top</a></li>";

				$('ul#search_result').animate({'height': '300px','overflow-y':'scroll'}, 200);
				$('ul#search_result').html(result);
			})
		}
		
		
	  var position = $('#search_result').offset().top;
      $('body,html').animate({scrollTop:position}, 1000, 'swing');

		
	});



});



</script>
</head>
<body>
<header>
  <div id="Header_wrp">
    <div class="Header">
      <div id="Logo"><img src="images/logo.png" width="410" height="81" alt="ChromContact" /></div>
      <div id="Menu">
        <ul>
          <li class="current"><a href="index.php">HOME</a></li>
          <li><a href="about.html">ABOUT</a></li>
          <li><a href="tutorial.html">TUTORIAL</a></li>
          <li><a href="mailto:mikita@bioreg.kyushu-u.ac.jp">CONTACT</a></li>
        </ul>
      </div>
    </div>
  </div>
</header>
<main>
  <div id="Main_wrp">
    <div class="Main top"></div>
    <div class="Main middle">
    <p>ChromContact is a web server for analyzing spatial contact of chromosomes from the publicly available Hi-C data. For the input, ChromContact uses a genomic coordinate, a gene symbol, or a SNP ID in GWAS Catalog. To analyze multiple loci, users may specify the input genomic coordinates in BED format. For the output, ChromContact generates (1) a link to UCSC Genome Browser for visual inspection of the retrieved contact profiles together with other genome annotations; and (2) normalized contact counts in text-based BedGraph format for each specified cell type.</p>
        <h2>Input</h2>
        <div class="block all">
          <table class="noborder">
            <tbody>
              <tr>
                <th>-chr and position, gene, SNP<br /><br /><br />OR</th>
                <td><input type="text" name="key" id="key"/>
                  <br>
                  <p class="explain"> Examples:“chr8:128,748,315”,“myc”,“rs6983267”<br/>
                    (For SNPs, only those in NHGRI GWAS Catalog are searchable.) <br/>
                    Genomic coordinate based on hg19. </p></td>
              </tr>

		      <form id="searchform">


              <tr>
                <th>-BED file</th>
                <td><input type="file" name="upload" id="upload" /></td>
              </tr>
            </tbody>
          </table>
        </div>
        <hr />
        <div class="btn add"><img src="images/btn_add.png" width="22" height="22" alt="addition"/></div>


        <h3>Options</h3>
		<div id="options_table">
        				            
            <table class="options">
			  <tr>
				<th>Cell Types:</th>
				<th>Resolution:</th>
			  </tr>
			  <tr>
				<td><input type="checkbox" name="cell1" id="cell1" value="1" checked='checked' >
				  <label for="cell1" >GM12878</label></td>
				<td><select name="resolution1" id="resolution1">
					<option value="5"  >5 kb</option>
					<option value="10" selected='selected' >10 kb</option>
					<option value="25"  >25 kb</option>
				  </select></td>
			  </tr>
			  <tr>
				<td><input type="checkbox" name="cell2" id="cell2" value="2"  >
				  <label for="cell2" >IMR90</label></td>
				<td><select name="resolution2" id="resolution2">
					<option value="5"  >5 kb</option>
					<option value="10" selected='selected' >10 kb</option>
					<option value="25"  >25 kb</option>
				  </select></td>
			  </tr>
			  <tr>
				<td><input type="checkbox" name="cell3" id="cell3" value="3" checked='checked' >
				  <label for="cell3" >HMEC</label></td>
				<td><select name="resolution3" id="resolution3">
					<option value="5"  >5 kb</option>
					<option value="10" selected='selected' >10 kb</option>
					<option value="25"  >25 kb</option>
				  </select></td>
			  </tr>
			  <tr>
				<td><input type="checkbox" name="cell4" id="cell4" value="4"  >
				  <label for="cell4" >K562</label></td>
				<td><select name="resolution4" id="resolution4">
					<option value="5"  >5 kb</option>
					<option value="10" selected='selected' >10 kb</option>
					<option value="25"  >25 kb</option>
				  </select></td>
			  </tr>
			  <tr>
				<td><input type="checkbox" name="cell5" id="cell5" value="5"  >
				  <label for="cell5" >NHEK</label></td>
				<td><select name="resolution5" id="resolution5">
					<option value="5"  >5 kb</option>
					<option value="10" selected='selected' >10 kb</option>
					<option value="25"  >25 kb</option>
				  </select></td>
			  </tr>
			  <tr>
				<td><input type="checkbox" name="cell6" id="cell6" value="6"  >
				  <label for="cell6" >HUVEC</label></td>
				<td><select name="resolution6" id="resolution6">
					<option value="5"  >5 kb</option>
					<option value="10" selected='selected' >10 kb</option>
					<option value="25"  >25 kb</option>
				  </select></td>
			  </tr>
			</table>
		</div>
        <input id="search_button" type="button" value="Submit" />
      </form>
      
      <a name="result"></a>
      <h3>Results</h3>
      <div>
      	<ul id="search_result">
        	<li>Please specify the keyword.</li>
        </ul>
      </div>      
    </div>
    <!-- .middle -->
    <div class="Main bottom"></div>
  </div>
</main>
<footer>
  <div id="Footer_wrp">
    <div class="Footer">
      <p>Copyright©2015. Kyushu University. All Rights Reserved.</p>
    </div>
  </div>
</footer>
</body>
</html>

